<!DOCTYPE html>
<html lang="en">
<%- include('includes/head.ejs') %>
<body>
    <%- include('includes/header.ejs') %>
    <main class="fade-in">
        <div class="text-center">
            <h1>Blog Posts</h1>
            <p>Discover amazing content from our community of writers.</p>
        </div>
        
        <% if (posts.length) { %>
            <div class="posts-grid">
                <% posts.forEach(post => { %>
                    <article class="post-card">
                        <a href="/post/<%= post.id %>" class="post-title"><%= post.title %></a>
                        <div class="post-meta" style="margin: 0.5rem 0; padding: 0; border: none; font-size: 0.9rem;">
                            <span class="author">By <%= post.username %></span>
                            <span class="date">â€¢ <%= new Date(post.createdDate).toLocaleDateString('en-US', { 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric'
                            }) %></span>
                        </div>
                        <div class="post-excerpt">
                            <% 
                                // First render the markdown to HTML
                                const renderedContent = filterUserHTML(post.body);
                                // Then truncate the HTML content (removing HTML tags for length calculation)
                                const textContent = renderedContent.replace(/<[^>]*>/g, '');
                                const shouldTruncate = textContent.length > 150;
                                const truncatedText = shouldTruncate ? textContent.substring(0, 150) + '...' : textContent;
                                
                                // If we need to truncate, we'll show the truncated text as plain text
                                // Otherwise, show the full rendered content
                                if (shouldTruncate) {
                            %>
                                <%= truncatedText %>
                            <% } else { %>
                                <%- renderedContent %>
                            <% } %>
                        </div>
                        <div style="margin-top: 1rem;">
                            <a href="/post/<%= post.id %>" class="button" style="display: inline-block; padding: 0.5rem 1rem; font-size: 0.9rem;">Read More</a>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else { %>
            <div class="text-center">
                <h2>No posts yet</h2>
                <p>Be the first to share your thoughts! <a href="/login">Log in</a> to create a post.</p>
            </div>
        <% } %>
    </main>

    <%- include('includes/footer.ejs') %>
</body>
</html>
